<%- include('./partials/header') %>

<div class="container mx-auto px-4 py-8">
    <!-- Flash Messages -->
    <% if (success && success.length > 0) { %>
        <div class="mb-4 p-3 rounded-md bg-blue-500 text-white">
            <%= success %>
        </div>
    <% } %>
    <% if (error && error.length > 0) { %>
        <div class="mb-4 p-3 rounded-md bg-red-500 text-white">
            <%= error %>
        </div>
    <% } %>

    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Cart Summary -->
        <div class="w-full lg:w-2/3">
            <h2 class="text-2xl font-semibold mb-4">Cart Summary</h2>
            <div class="bg-white shadow-md rounded-lg p-6">
                <% user.cart.forEach(item => { %>
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-4">
                            <img class="w-24 h-24 object-cover rounded-md" src="data:image/jpeg;base64,<%= item.image.toString('base64') %>" alt="<%= item.name %>">
                            <div>
                                <h3 class="font-semibold text-lg"><%= item.name %></h3>
                                <p class="text-gray-600">₹<%= item.price %></p>
                                <p class="text-gray-600">Qty: <%= item.quantity %></p>
                            </div>
                        </div>
                        <div class="text-lg font-semibold">₹<%= item.price * item.quantity %></div>
                    </div>
                <% }) %>
                <div class="flex justify-between font-semibold text-lg mt-4 border-t pt-4">
                    <span>Total</span>
                    <span>₹<%= total %></span>
                </div>
            </div>
        </div>

        <!-- Shipping Information -->
        <div class="w-full lg:w-1/3">
            <h2 class="text-2xl font-semibold mb-4">Shipping Information</h2>
            <div class="bg-white shadow-md rounded-lg p-6">
                <form action="/complete-checkout" method="POST">
                    <div class="mb-4">
                        <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div class="mb-4">
                        <label for="address" class="block text-sm font-medium text-gray-700">Address</label>
                        <textarea id="address" name="address" rows="3" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="city" class="block text-sm font-medium text-gray-700">City</label>
                        <input type="text" id="city" name="city" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div class="mb-4">
                        <label for="postalCode" class="block text-sm font-medium text-gray-700">Postal Code</label>
                        <input type="text" id="postalCode" name="postalCode" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <div class="mb-4">
                        <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                        <input type="text" id="phone" name="phone" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    <button type="submit" <%- include('./partials/header') %>

                        <% if (messages.error) { %>
                          <div class="alert alert-danger">
                            <%= messages.error %>
                          </div>
                        <% } %>
                        <% if (messages.success) { %>
                          <div class="alert alert-success">
                            <%= messages.success %>
                          </div>
                        <% } %>
                        
                        <h1>Checkout</h1>
                        
                        <form action="/complete-checkout" method="POST">
                          <div class="form-group">
                            <label for="name">Name:</label>
                            <input type="text" id="name" name="name" class="form-control" required>
                          </div>
                          <div class="form-group">
                            <label for="address">Address:</label>
                            <input type="text" id="address" name="address" class="form-control" required>
                          </div>
                          <div class="form-group">
                            <label for="city">City:</label>
                            <input type="text" id="city" name="city" class="form-control" required>
                          </div>
                          <div class="form-group">
                            <label for="postalCode">Postal Code:</label>
                            <input type="text" id="postalCode" name="postalCode" class="form-control" required>
                          </div>
                          <div class="form-group">
                            <label for="phone">Phone:</label>
                            <input type="text" id="phone" name="phone" class="form-control" required>
                          </div>
                        
                          <div class="checkout-summary">
                            <h2>Order Summary</h2>
                            <p>Total: ₹<%= total %></p>
                          </div>
                        
                          <button type="submit" class="btn btn-primary">Complete Purchase</button>
                        </form>
                        
                        <%- include('./partials/footer') %>
                        class="w-full bg-blue-500 text-white py-2 px-4 rounded-md shadow-md hover:bg-blue-600 transition">Complete Purchase</button>
                </form>
            </div>
        </div>
    </div>
</div>

<%- include('./partials/footer') %>
